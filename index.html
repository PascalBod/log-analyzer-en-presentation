<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<link rel="icon" href="favicon.ico" type="image/x-icon">

		<title>Log analyzer</title>

		<link rel="stylesheet" href="dist/reset.css">
		<link rel="stylesheet" href="dist/reveal.css">
		<link rel="stylesheet" href="dist/theme/pb.css">
		<link rel="stylesheet" href="pres-style.css">

		<!-- Theme used for syntax highlighting of code -->
		<link rel="stylesheet" href="plugin/highlight/monokai.css">
		
		<!-- Matomo -->
		<script type="text/javascript">
			var _paq = window._paq = window._paq || [];
			/* tracker methods like "setCustomDimension" should be called before "trackPageView" */
			_paq.push(['trackPageView']);
			_paq.push(['enableLinkTracking']);
			(function () {
				var u = "//matomo.systev.com/";
				_paq.push(['setTrackerUrl', u + 'matomo.php']);
				_paq.push(['setSiteId', '3']);
				var d = document, g = d.createElement('script'), s = d.getElementsByTagName('script')[0];
				g.type = 'text/javascript'; g.async = true; g.src = u + 'matomo.js'; s.parentNode.insertBefore(g, s);
			})();
		</script>
		<!-- End Matomo Code -->

	</head>
	<body>
		<div class="reveal">
			<div class="slides">
				<section> <h1>A simple tailor-made log analyzer</h1>
					<h5>Pascal Bodin</h5>
					<img src="images/logAnalyzer.png" height="350">
				</section>
				<section> <h2>Document history</h2>
					<table class="pbsmaller">
						<thead>
							<tr>
								<th>When</th>
								<th>What</th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<td>21-Feb-2021</td>
								<td>Figure on first page</td>
							</tr>
							<tr>
								<td>20-Feb-2021</td>
								<td>Version 1.0</td>
							</tr>
						</tbody>
					</table>
				</section>
				<section> <h3>License</h3>
					<a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">
						<img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png" /></a>
						<br />This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License</a>
				</section>
				<section><h3>Credits</h3>
					<ul>
						<li><a target="_blank" href="https://github.com/hakimel/reveal.js">reveal.js</a> - Copyright (C) 2021 Hakim El Hattab</li>
						<li><a href="https://www.flaticon.com/authors/kiranshastry" title="Kiranshastry" target="_blank">Kiranshastry</a> from <a href="https://www.flaticon.com/" title="Flaticon" target="_blank">www.flaticon.com</a></li>
						<li><a href="https://www.freepik.com" title="Freepik" target="_blank">Freepik</a> from <a href="https://www.flaticon.com/" title="Flaticon" target="_blank">www.flaticon.com</a></li>
						<li><a href="https://matomo.org/" target="_blank">Matomo</a></li>
					</ul>
				</section>
				<section> 
					<section> <h3>Contents</h3>
                        <ul>
                            <li><a href="#/foreword">Foreword</a></li>
                            <li><a href="#/requirements">Requirements</a></li>
                            <li><a href="#/format">Message format</a></li>
                            <li><a href="#ourRequirements">Adding our requirements</a></li>
                            <li><a href="#/lowLevel">Message structure - low level</a></li>
                            <li><a href="#/rules">Rules</a></li>
							<li><a href="#/implementation">Implementation</a></li>
							<li><a href="#/conclusion">Conclusion</a></li>
							<li><a href="#/references">References</a></li>
                        </ul>
                    </section>
				</section>
				<section>
					<section id="foreword"> <h3>Foreword</h3>
					</section>
					<section> <h3>Who am I?</h3>
						<ul>
							<li><a href="https://systev.com" target="_blank">
								half-time independent consultant - connected devices</a> <br/>
								<a href="https://www.ackl.io" target="_blank">
									<img src="images/logo-acklio.png"></a>
								&nbsp;
								<a href="https://www.connectedcycle.com" target="_blank">
									<img src="images/logo-connectedCycle.png"></a>
							</li>
							<li>half-time senior software engineer <br/>
								<a href="https://www.orange.com/en" target="_blank">
									<img src="images/logo-orange.png" style="vertical-align: middle;">
								</a>
								&nbsp;-&nbsp;appointed <em>Orange Expert</em>
							</li>
							<li>First connected devices project in 1990</li>
						</ul>
					</section>
					<section> <h4>More information</h4>
						<ul>
							<li><a href="https://systev.com" target="_blank">Systev</a></li>
							<li><a href="https://twitter.com/pascalbod06" target="_blank">Twitter</a></li>
							<li><a href="https://www.linkedin.com/in/pascalbodin/" target="_blank">LinkedIn</a></li>
							<li><a href="https://github.com/PascalBod" target="_blank">GitHub</a></li>
						</ul>
					</section>
				</section>
                <section id="requirements"> <h3>Requirements</h3>
                    <ul>
                        <li>Functional requirements:
                            <ul>
                                <li>Analyze a specific type of log messages</li>
                            </ul>
                        </li>
                        <li>Non-functional requirements:
                            <ul>
                                <li>Must run in a constrained environment (little RAM, little disk space)</li>
                            </ul>
                        </li>
                    </ul>
                </section>
                <section id="format"> <h3>Message format</h3>
                    <p>The only specification:</p>
                    <pre><code data-trim data-noescape class="plaintext">
                        Y/M/Dâ€“H/MN.S, service, 
                            parameter1 = [value1, value2], 
                            parameterN = parameterN value,
                            ...
                    </code></pre>
                </section>
                <section> <h3>Example</h3>
                    <pre><code data-trim data-noescape class="plaintext">
                        2020/11/30-07:51:38, BOOT, Type = UpTime, TimeUp = 3710
                        2020/11/30-07:51:38, MEMINFO, MemTotal = 95919, 
                                MemFree = 59158, Buffers = 3787, Cached = 10252
                        2020/11/30-07:51:38, SENSORS, Fan_HDD = 0
                        2020/11/30-07:50:28, NETWORK, Type = NetworkDelay, 
                                ClientNetworkDelays = [1,0,0,0,0,0,0,0,0,0,0,0], 
                                MeanClientNetworkDelay = 0.000000e+00
                    </code></pre>
                </section>
                <section>
                    <p>For simplification, let's ignore timestamp in what follows.</p>
                    <p>It's easy to extract it:
                        <ul>
                            <li>Start of line</li>
                            <li>Fixed format</li>
                        </ul>
                    </p>
                </section>
                <section id="ourRequirements"> <h3>Adding our requirements</h3>
                    <ul>
                        <li>As format is not described in a formal way:
                            <ul>
                                <li>Should be easy to adapt the analyzer</li>
                            </ul>
                        </li>
                        <li>New types of messages may appear:
                            <ul>
                                <li>Should be easy to adapt the analyzer (bis)</li>
                            </ul>
                        </li>
                        <li>Embedded software: 
							<ul>
								<li>must use little RAM</li>
								<li>must be reliable</li>
							</ul>
						</li>
                    </ul>
                </section>
                <section id="lowLevel"> <h3>Message structure - low level</h3>
                    <pre><code data-trim data-noescape class="plaintext">
                        NETWORK, Type = NetworkDelay, 
                                ClientNetworkDelays = [1,0,0,0,0,0,0,0,0,0,0,0], 
                                MeanClientNetworkDelay = 0.000000e+00
                    </code></pre>
                    <p>Different elements:</p>
                    <ul>
                        <li>Specific characters: <code>,</code>&nbsp;<code>=</code>&nbsp;<code>[</code>&nbsp;<code>]</code></li>
                        <li>Strings</li>
                    </ul>
					<p>Remember: we consider that timestamps are no more present.</p>
                </section>
                <section> <h3>Sentences</h3>
                    <ul>
                        <li>These elements are combined according to some rules</li>
                        <li>These rules: <em>syntax</em></li>
                    </ul>
                </section>
                <section id="rules"> <h3>Rules</h3>
                    <p>How to describe all possible messages?</p>
                    <p>Let's try with a sample message:</p>
                    <img src="images/message.png">
                </section>
                <section> <h3>Rule 1</h3>
                    <pre><code data-trim data-noescape class="plaintext">
                        message = service parameterList
                    </code></pre>
                </section>
                <section> <h3>Let's go on</h3>
                    <img src="images/parameterList.png">
                </section>
                <section> <h3>Rule 2</h3>
                    <pre><code data-trim data-noescape class="plaintext">
                        parameterList = (',' parameter)+
                    </code></pre>
					<p>Notation:</p>
					<ul>
						<li><code>(</code> and <code>)</code> => to group elements</li>
						<li><code>+</code> => element repeated one or more times</li>
					</ul>
                </section> <section> <h3>Let's go on</h3>
                    <img src="images/parameter.png">
                </section>
                <section> <h3>Rule 3</h3>
                    <pre><code data-trim data-noescape class="plaintext">
                        parameter = parameterName '=' parameterValueList
                    </code></pre>
				</section>
				<section> <h3>Rules 4 and 5</h3>
					<pre><code data-trim data-noescape class="plaintext">
						parameterValueList = value | '[' valueList ']'
						valueList = value ( ',' value)+
					</code></pre>
					<p>Notation:</p>
					<ul>
						<li><code>|</code> => alternative</li>
					</ul>
				</section>
				<section> <h3>The whole set of rules</h3>
					<pre><code data-trim data-noescape class="plaintext">
						message = service parameterList
						parameterList = (',' parameter)+
						parameter = parameterName '=' parameterValueList
						parameterValueList = value | '[' valueList ']'
						valueList = value ( ',' value)+
						service = STRING
						parameterName = STRING
						value = STRING
					</code></pre>
				</section>
				<section> <h3>Generalization</h3>
					<ul>
						<li><em>terminals:</em> elements that can't be transformed according to previous rules</li>
						<li><em>non terminals:</em> elements that can be transformed</li>
						<li><em>productions:</em> rules</li>
						<li><em>start symbol:</em> the non terminal that denotes our language (<code>message</code>)</li>
						<li><em>grammar:</em> the set of the above four types of items</li>
						<li><em>language:</em> all the sentences that can be produced with the grammar</li>
						<li><em>EBNF (Extended Backus Naur Form):</em> the metasyntax we used to express the productions</li>
					</ul>
				</section>
				<section id="implementation"> <h3>Implementation</h3>
					<ul>
						<li>First step: lexical analysis
							<ul>
								<li>transforms a message into a list of <em>tokens</em> (elements): specific characters and strings</li>
								<li>for our simple example: a finite-state machine</li>
							</ul>
						</li>
					</ul>
				</section>
				<section>
					<img src="images/fsmLexicalAnalyzer.png">
					<p>For the sake of simplification, space and tab characters processing is omitted.</p>
				</section>
				<section>
					<ul>
						<li>Second step: syntactic analysis (parsing)
							<ul>
								<li>checks that the list of tokens is a sentence of the language</li>
								<li>builds a data structure containing a usable representation of the sentence</li>
							</ul>
						</li>
					</ul>
				</section>
				<section>
					<ul>
						<li>For our simple grammar, we can use <em>top-down parsing</em> </li>
						<li>A function is created for each non terminal</li>
						<li>Each function calls other function(s) and/or processes token(s)</li>
					</ul>
				</section>
				<section>
					<pre><code data-trim data-noescape class="c++">
						void parse_message() {
							get_service();
							get_parameter_list();
						}
					</code></pre>
				</section>
				<section>
					<pre><code data-trim data-noescape class="c++">
						void get_service() {
							token_t token = get_token();
							add_service_data(token);
						}
					</code></pre>
				</section>
				<section>
					<pre><code data-trim data-noescape class="c++">
						void get_parameter_list() {
							while(true) {
								get_comma();
								get_parameter();
								if (!next_is_comma()) {
									break;
								}
							}
						}
					</code></pre>
				</section>
				<section>
					<p class="pbcenter">Etc.</p>
				</section>
				<section> <h3>Error processing</h3>
					<pre><code data-trim data-noescape class="c++">
						error_t parse_message() {
							rs = get_service();
							if (rs != SUCCESS) return rs;
							rs = get_parameter_list();
							return rs;
						}
					</code></pre>
				</section>
				<section>
					<pre><code data-trim data-noescape class="c++">
						error_t get_service() {
							token_t token = get_token();
							if (token.type != string_token) {
								return WRONG_TOKEN_TYPE;
							} 
							return add_service_data(token);
						}
					</code></pre>
				</section>
				<section>
					<pre><code data-trim data-noescape class="c++">
						error_t get_parameter_list() {
							while(true) {
								rs = get_comma();
								if (rs != SUCCESS) return rs;
								rs = get_parameter();
								if (rs != SUCCESS) return rs;
								if (!next_is_comma()) {
									break;
								}
							}
							return SUCCESS;
						}
					</code></pre>
				</section>
				<section>
					<p>More has to be done for error processing:
						<ul>
							<li>Keep position in line with each token</li>
							<li>On error, display position, value and reason</li>
							<li>Do not crash &#x1F600;</li>
						</ul>
					</p>
				</section>
				<section id="conclusion"> <h3>Conclusion</h3>
					<ul>
						<li>Resulting code (in C) is short:
							<ul>
								<li>Lexical analyzer: 285 lines, including declarations</li>
								<li>Parser: 485 lines, including declarations</li>
							</ul>
						</li>
						<li>Really easy to adapt to a modification of the message format (this happened &#x1F600;) </li>
						<li>Reliable code</li>
						<li>For a more complex grammar, a parser generator (see <a href="#/references">References</a>) could have been used</li>
					</ul>
				</section>
				<section>
					<p>But:</p>
					<ul>
						<li>Some prior experience is required (typically: to ensure the grammar allows for easy parsing)</li>
						<li>Or reading some material about parsing (see <a href="#/references">References</a>)</li>
					</ul>
				</section>
				<section id="references"> <h3>References</h3>
					<ul>
						<li><a href="https://suif.stanford.edu/dragonbook/" target="_blank"><strong>Compilers: Principles, Techniques, and Tools</strong> - Aho, Ullman, Lam, Sethi</a> <em>(The Dragon Book)</em></li>
						<li><a href="https://web.stanford.edu/class/cs143/" target="_blank">Standford University course CS143</a></li>
						<li><a href="http://dinosaur.compilertools.net/" target="_blank">Lex and Yacc</a> - original Unix tools, to generate lexical analyzers and parsers</li>
						<li><a href="https://www.gnu.org/software/bison/" target="_blank">Bison</a> - parser generator, upward compatible with Yacc</li>
					</ul>
				</section>
			</div>
		</div>
	
		<script src="dist/reveal.js"></script>
		<script src="plugin/markdown/markdown.js"></script>
		<script src="plugin/highlight/highlight.js"></script>
		<script src="plugin/notes/notes.js"></script>
		<script>
		  Reveal.initialize({
			hash: true,
			plugins: [ RevealMarkdown, RevealHighlight, RevealNotes ],
			slideNumber: true
		  });
		</script>
		
	</body>
</html>
